<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.10586 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="373"/>

<div>
<span><div><span style="font-size: 19px;"><b>第二章</b></span></div><div><hr/></div><div><b><br/></b></div><div><b>创建一个项目：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;django-admin.py startproject mysite</div></div><div><br/></div><div><b>运行服务器：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;python manage.py runserver</div></div><div><br/></div><div><br/></div><div><span style="font-size: 19px;"><b>第三章 视图和URL配置</b></span></div><div><hr/></div><div><br/></div><div><b>创建 view.py （视图）：</b></div><div><b>编写 views.py（动态内容） :</b></div><div><img src="djangobook_note_files/Image.png" type="image/png" style="height: auto;"/></div><div><br/></div><div><b>绑定视图函数和URL</b></div><div><b>修改urls.py（配置松耦合，动态url）:</b></div><div><img src="djangobook_note_files/Image [1].png" type="image/png" style="height: auto;"/></div><div><br/></div><div>查看网站根目录使用空re:</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>url(r'^$', my_homepage_view)</div></div><div><br/></div><div><br/></div><div><br/></div><div><b><span style="font-size: 19px;">第四章 模板（Template）</span></b></div><div><hr/></div><div><b><br/></b></div><div><b>{{ person_name }}                     变量(variable)</b></div><div><b>{% if ordered_warranty %}       模板标签(template tag)</b></div><div><b>{{ship_date|date:&quot;F j, Y&quot;}}          filter过滤器</b></div><div><b><br/></b></div><div><b>创建Template对象：直接将其实例化</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; from django.template import Template</div><div>&gt;&gt;&gt; t = Template('My name is {{ name }}.')</div></div><div><b><br/></b></div><div><b>context在Django里表现为 Context 类，在 django.template 模块里。 她的构造函数带有一个可选的参数： 一个字典映射变量和它们的值。 调用 Template 对象 的 render() 方法并传递context来填充模板：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; from django.template import Context, Template    </div><div>          <span style="color: rgb(255, 0, 0);">#context在Django里表现为 Context 类，在 django.template 模块里</span></div><div>&gt;&gt;&gt; t = <b>Template</b>('My name is {{ name }}.')</div><div>&gt;&gt;&gt; c = <b>Context</b>({'name': 'Stephane'})</div><div>          <span style="color: rgb(255, 0, 0);">#字典映射 变量 和 值</span></div><div>&gt;&gt;&gt; <b>t.render</b>(c)</div><div>u'My name is Stephane.</div></div><div><b><br/></b></div><div><b>在 Django 模板中遍历复杂数据结构的关键是句点字符 (.)</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; from django.template import Template, Context</div><div>&gt;&gt;&gt; person = {'name': 'Sally', 'age': '43'}</div><div>&gt;&gt;&gt; t = Template('{{ person.name }} is {{ person.age }} years old.')</div><div>&gt;&gt;&gt; c = Context({'person': person})</div><div>&gt;&gt;&gt; t.render(c)</div><div>u'Sally is 43 years old.'</div></div><div><b>句点查找可以多级深度嵌套。 例如在下面这个例子中 {{person.name.upper}} 会转换成字典类型查找（ person['name'] ) 然后是方法调用（ upper() ):</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; from django.template import Template, Context</div><div>&gt;&gt;&gt; person = {'name': 'Sally', 'age': '43'}</div><div>&gt;&gt;&gt; t = Template('{{ <span style="color: rgb(255, 0, 0);">person.name.upper</span> }} is {{ person.age }} years old.')</div><div>&gt;&gt;&gt; c = Context({'person': person})</div><div>&gt;&gt;&gt; t.render(c)</div><div>u'<span style="color: rgb(255, 0, 0);">SALLY</span> is 43 years old.'</div></div><div><b><br/></b></div><div><b>标签{% blah %}：</b></div><div><b>注释{# blah #}：</b></div><div><b>过滤器{{ name|lower }} :</b></div><div><b><br/></b></div><div><b>模板加载：</b></div><div><b>修改settings.py:</b></div><div><img src="djangobook_note_files/Image [2].png" type="image/png" style="height: auto;"/></div><div><br/></div><div>（修改views.py:）且慢！还有更好的方法！</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>django.template.loader.get_template()     #自动加载模板 </div></div><div><br/></div><div><b>在template中创建模板current_datetime.html：</b></div><div><b><br/></b></div><div><b>render_to_response()</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><b><span style="color: rgb(255, 0, 0);">from django.shortcuts import render_to_response</span></b></div><div>import datetime</div><div><br/></div><div>def current_datetime(request):</div><div>    now = datetime.datetime.now()</div><div>    <b><span style="color: rgb(255, 0, 0);">return render_to_response('current_datetime.html', {'current_date': now})</span></b></div></div><div><b>不再需要导入 get_template 、 Template 、 Context 和 HttpResponse 。相反，导入 <span style="color: rgb(255, 0, 0);">django.shortcuts.render_to_response</span></b></div><div><b> </b></div><div><b>locals() 技巧</b></div><div><b><br/></b></div><div><b>模板继承：{% extends %} {% block %}</b></div><div><b>base.html</b></div><div><img src="djangobook_note_files/Image [3].png" type="image/png" style="height: auto;"/></div><div><b>current_datetime.html</b></div><div><img src="djangobook_note_files/Image [4].png" type="image/png" style="height: auto;"/></div><div><b>hours_ahead.html</b></div><div><img src="djangobook_note_files/Image [5].png" type="image/png" style="height: auto;"/></div><div>如果需要访问父模板中的块的内容，使用 <b>{{ block.super }}</b>，这一个魔法变量将会表现出父模板中的内容。 如果只想在上级代码块基础上添加内容，而不是全部重载，该变量就显得非常有用了。</div><div><br/></div><div><br/></div><div><br/></div><div><b><span style="font-size: 19px;">第5章 模型（Models）</span></b></div><div><hr/></div><div><b><br/></b></div><div><b>修改setings.py:</b></div><div><img src="djangobook_note_files/Image [6].png" type="image/png" style="height: auto;"/></div><div><b><span style="font-size: 19px;"><br/></span></b></div><div><b>shell中检测数据库配置 ：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; from django.db import connection</div><div>&gt;&gt;&gt; cursor = connection.cursor()</div></div><div><br/></div><div><b>创建&quot;books&quot;app:</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>python manage.py startapp books</div></div><div><br/></div><div><b>编写models.py:</b></div><div><img src="djangobook_note_files/Image [7].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><b>修改settings.py:</b></div><div><img src="djangobook_note_files/Image [8].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><br/></div><div><b>验证模型有效型：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>python manage.py check</div></div><div>返回0 errors found</div><div><br/></div><div><b>生成create table:</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;python manage.py <b>makemigrations books</b></div><div>         #用来检测数据库变更和生成数据库迁移文件</div><div>&gt;python manage.py <b>sqlmigrate books 0001</b></div><div>         #用来把数据库迁移文件转换成数据库语言</div><div>&gt;python manage.py <b>migrate</b>                     </div><div>         #用来迁移数据库</div></div><div><br/></div><div><b>基本数据访问：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; <b>from books.models import Publisher</b></div><div>&gt;&gt;&gt; p1 = Publisher(name='Apress', address='2855 Telegraph Avenue',</div><div>...     city='Berkeley', state_province='CA', country='U.S.A.',</div><div>...     website='http://www.apress.com/')</div><div>&gt;&gt;&gt; <b>p1.save()</b></div><div>&gt;&gt;&gt; p2 = Publisher(name=&quot;O'Reilly&quot;, address='10 Fawcett St.',</div><div>...     city='Cambridge', state_province='MA', country='U.S.A.',</div><div>...     website='http://www.oreilly.com/')</div><div>&gt;&gt;&gt; <b>p2.save()</b></div><div>&gt;&gt;&gt; <b>publisher_list = Publisher.objects.all()</b></div><div>&gt;&gt;&gt; publisher_list</div><div>&lt;QuerySet [&lt;Publisher: Publisher object&gt;, &lt;Publisher: Publisher object&gt;]&gt;</div></div><div><b>.save 或用 objects.create() 方法:</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; p1 = Publisher.objects.<b>create</b>(name='Apress',</div><div>...     address='2855 Telegraph Avenue',</div><div>...     city='Berkeley', state_province='CA', country='U.S.A.',</div><div>...     website='http://www.apress.com/')</div><div>&gt;&gt;&gt; p2 = Publisher.objects.<b>create</b>(name=&quot;O'Reilly&quot;,</div><div>...     address='10 Fawcett St.', city='Cambridge',</div><div>...     state_province='MA', country='U.S.A.',</div><div>...     website='http://www.oreilly.com/')</div><div>&gt;&gt;&gt; publisher_list = <b>Publisher.objects.all()</b></div><div>&gt;&gt;&gt; publisher_list</div></div><div><br/></div><div><b>每个models模块添加方法__str__()：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>def __str__(self):</div><div>        return self.name</div></div><div>输出结果对比：</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;QuerySet [&lt;Publishier: object&gt;, &lt;Publishier: object&gt;]&gt;</div><div>&lt;QuerySet [&lt;Publishier: O'Reilly&gt;, &lt;Publishier: Apress&gt;]&gt;</div></div><div><br/></div><div><b>插入和更新数据：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; p.name = 'Apress Publishing'</div><div>&gt;&gt;&gt; p.save()</div></div><div><br/></div><div><b>选择对象：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; <b>Publisher.objects.all()</b></div><div>&lt;QuerySet [&lt;Publishier: Apress&gt;, &lt;Publishier: O'Reilly&gt;]&gt;</div></div><div><br/></div><div><b>数据过滤：</b></div><div><b>filter():</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; Publisher.objects.filter(name='Apress')</div><div>[&lt;Publisher: Apress&gt;]</div></div><div>可传入多个参数：</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; Publisher.objects.filter(country=&quot;U.S.A.&quot;, state_province=&quot;CA&quot;)</div><div>[&lt;Publisher: Apress&gt;]</div></div><div>__contains:</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; Publishier.objects.filter(name__contains=&quot;press&quot;)</div><div>[&lt;Publisher: Apress&gt;]</div></div><div><br/></div><div><b>获取单个对象：</b></div><div><b>get():</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; Publisher.objects.get(name=&quot;Apress&quot;)</div><div>&lt;Publisher: Apress&gt;</div></div><div><br/></div><div><b>filter()和get():</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; type(Publishier.objects.filter(name='Apress'))</div><div><b>&lt;class 'django.db.models.query.QuerySet'&gt;</b></div><div>&gt;&gt;&gt; type(Publishier.objects.get(name='Apress'))</div><div><b>&lt;class 'books.models.Publishier'&gt;</b></div></div><div><br/></div><div><b>数据排序：</b></div><div><b>order_by():</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; Publisher.objects.order_by(&quot;name&quot;)</div><div>[&lt;Publisher: Apress&gt;, &lt;Publisher: O'Reilly&gt;]</div></div><div>可对任意字段：</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; Publisher.objects.order_by(&quot;address&quot;)</div><div>[&lt;Publisher: O'Reilly&gt;, &lt;Publisher: Apress&gt;]</div><div><br/></div><div>&gt;&gt;&gt; Publisher.objects.order_by(&quot;state_province&quot;)</div><div>[&lt;Publisher: Apress&gt;, &lt;Publisher: O'Reilly&gt;]</div></div><div>逆向：</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; Publisher.objects.order_by(<span style="color: rgb(255, 0, 0);">&quot;-name&quot;</span>)</div><div>[&lt;Publisher: O'Reilly&gt;, &lt;Publisher: Apress&gt;]</div></div><div>重复排序可定义 class Meta：</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>class Meta:</div><div>     ordering = ['name']</div></div><div><br/></div><div><b>连锁查询：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; Publisher.objects<b>.filter(country=&quot;U.S.A.&quot;).order_by(&quot;-name&quot;)</b></div><div>[&lt;Publisher: O'Reilly&gt;, &lt;Publisher: Apress&gt;]</div></div><div><br/></div><div><b>限制返回数据：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; Publisher.objects.order_by('name')[0]</div><div>&lt;Publisher: Apress&gt;</div><div>&gt;&gt;&gt; Publisher.objects.order_by('name')[0:2]</div><div>&gt;&gt;&gt; Publisher.objects.order_by('-name')[0]</div></div><div><br/></div><div><b><span style="color: rgb(51, 51, 51);">更新多个对象：</span></b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; p = Publisher.objects.get(name='Apress')</div><div>&gt;&gt;&gt; p.name = 'Apress Publishing'</div><div>&gt;&gt;&gt; p.save()</div><div>&gt;&gt;&gt;</div><div>&gt;&gt;&gt; #假设id为52</div><div>&gt;&gt;&gt; Publisher.objects.filter(id=52).update(name='Apress Publishing')</div><div>&gt;&gt;&gt;</div><div>&gt;&gt;&gt;&gt;&gt;&gt; Publisher.objects.all().update(country='USA')</div><div>2</div></div><div><b><span style="color: rgb(51, 51, 51);"><br/></span></b></div><div><b><span style="color: rgb(51, 51, 51);">删除对象：</span></b></div><div><b><span style="color: rgb(51, 51, 51);">delete():</span></b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;&gt;&gt; p = Publisher.objects.get(name=&quot;O'Reilly&quot;)</div><div>&gt;&gt;&gt; p.delete()</div><div>&gt;&gt;&gt; Publisher.objects.all()</div><div>[&lt;Publisher: Apress Publishing&gt;]</div><div>&gt;&gt;&gt;</div><div>&gt;&gt;&gt; Publisher.objects.filter(country='USA').delete()</div><div>&gt;&gt;&gt; Publisher.objects.all().delete()</div></div><div><b><span style="color: rgb(51, 51, 51);"><br/></span></b></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><br/></span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><br/></span></span></span></div><div><b><span style="font-size: 19px;"><span style="color: rgb(51, 51, 51);">第六章 Django站点管理</span></span></b></div><div><hr/></div><div><b><span style="font-size: 19px;"><span style="color: rgb(51, 51, 51);"><br/></span></span></b></div><div><b>激活管理界面：</b></div><div><b>修改settings.py:</b></div><div><img src="djangobook_note_files/Image [9].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><b>创建超级用户：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&gt;python manage.py migrate</div><div>&gt;python manage.py createsuperuser</div><div>...</div><div>Superuser created successfully.</div></div><div>（只有包含'django.contrib.auth'才可createsuperuser）</div><div><br/></div><div><b>将admin访问配置在URLconf(urls.py)：</b></div><div>貌似新版这里不用修改</div><div><img src="djangobook_note_files/Image [10].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><b>使用管理工具</b></div><div><b>更改管理页面语言：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>‘django.middleware.locale.LocaleMiddleware’</div></div><div>确保其在'django.contrib.sessions.middleware.SessionMiddleware'之后</div><div><br/></div><div><b>将Models加入到Admin管理中</b></div><div><b>编辑admin.py:</b></div><div><img src="djangobook_note_files/Image [11].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><b>设置字段可选：</b></div><div>设置Author中eamail字段为可选：（修改models.py）</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>email = models.EmailField(<b>blank = True</b>)          #该字段可选</div></div><div>email不再为粗体：</div><div><img src="djangobook_note_files/Image [12].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><b>设置日期型和数字型字段可选：</b></div><div> 在Django模块中，你可以通过添加<b>null=True</b>来指定一个字段允许为NULL</div><div> 如果想允许一个日期型（DateField、TimeField、DateTimeField）或数字型（IntegerField、DecimalField、 FloatField）字段为空，需要使用<b>null=True</b> 和 <b>blank=True</b>。</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>publication_date = models.DateField(blank = True, null = True)  #允许字段为空</div></div><div><br/></div><div><b>自定义字段标签：使用 verbose_name :</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>email = models.EmailField(blank = True, verbose_name = 'e-mail')</div><div>或</div><div>email = models.EmailField('e-mail', blank = True )</div><div>ManyToManyField 和 ForeinKey 不可用，因为第一个参数是模块类名</div></div><div><br/></div><div><b>自定义ModelAdmi类：</b></div><div><b>ModelAdmin classes</b></div><div><br/></div><div><b>自定义列表：</b></div><div>为<b>Author</b>模块定义一个<b>ModelAdmin</b>类</div><div><b>修改admin.py：</b><img src="djangobook_note_files/Image [13].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><b>添加快速查询栏：</b></div><div><b>修改admin.py：</b></div><div>在 class AuthorAdmin(admin.ModelAdmin) 中添加 search_fields：</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>class AuthorAdmin(admin.ModelAdmin):</div><div>    #从django.contrib.admin.ModelAdmin派生出来的子类</div><div>    list_display = ('first_name', 'last_name', 'email')</div><div>    search_fields = ('first_name', 'last_name')</div></div><div><img src="djangobook_note_files/Image [14].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><b>为Book添加过滤器：</b><img src="djangobook_note_files/Image [15].png" type="image/png" style="height: auto;"/></div><div><img src="djangobook_note_files/Image [16].png" type="image/png" style="height: auto;"/></div><div>另一种过滤日期的方法是date_hierachy：</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><b>date_hierarchy</b> = 'publication_date'</div></div><div>排序</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><b>ordering</b> = (-publication_date)</div></div><div><br/></div><div><b>自定义编辑表单：</b></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div><b>fileds</b> = ('title', 'author', 'publishier', 'publication_date')</div></div><div><br/></div><div><b>多选框不方便</b></div><div><b>ManyToMany</b> <b>使用 filter_horizontal：</b></div><div>添加到 <b>BookAdmin</b> 中：</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>filter_horizontal = ('authors',)</div></div><div>注意移除fields选项，以使得编辑页面包含所有字段</div><div><b>filter_vertical</b>控件垂直排列</div><div><br/></div><div><b>ForeinKey</b> 使用 <b>raw_id_fields</b>：（展现为文本框而不是下拉框）</div><div><br/></div><div><br/></div><div><b>用户、用户组 和 权限：</b></div><div><br/></div><div><br/></div><div><br/></div><div><b><span style="font-size: 19px;">第七章 表单</span></b></div><div><hr/></div><div><span style="font-size: 19px;"><br/></span></div><div><b>从 Request 对象中获取数据：</b></div><div>每个view函数的第一个参数是一个HttpRequest对象</div><div><br/></div><div>URL相关信息：</div><div>HttpRequest 对象包含当前请求URL的一些信息：<img src="djangobook_note_files/Image [17].png" type="image/png" style="height: auto;"/></div><div><img src="djangobook_note_files/Image [18].png" type="image/png" style="height: auto;"/></div><div><br/></div><div><b>有关 request 的其他信息：</b></div><div><b>rquest.META</b> 是一个 dict，包含Header信息，以下常见键值：</div><div>     <b>HTTP_REFERER</b>                 进站前链接网页，如果有的话</div><div>     <b>HTTP_USER_AGENT</b>         user-agent字符串</div><div>     <b>REMOTE_ADDR</b>                客户端IP </div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 